/**
 * Created by vshkulev on 12/17/15.
 */

var $ = require('jquery');
var path = require('path');
var fs = require('fs');
var filesDir = 'data';
var plugins = require('electron-plugins');
var ipc = require('electron').ipcRenderer;

console.log('1.1.6');

$(document).ready(function () {
    // What it is?
    document.addEventListener('DOMContentLoaded', function () {
        var context = {document: document};
        plugins.load(context, function (err, loaded) {
            if (err) {
                return console.error(err);
            }
            console.log(loaded);
            console.log('Plugins loaded successfully.');
        });
    });

    ipc.on('update-available', function () {
        console.log('there is an update available for download');
    });

    var TableFileDecoder = require(path.join(__dirname, 'js', 'tableFileDecoder'));
    var files = fs.readdirSync(path.join(__dirname, filesDir));

    var tf;
    for (var i = 0; i < files.length; i++) {
        console.log(files[i]);
        tf = new TableFileDecoder(path.join(__dirname, filesDir, files[i]));
        if (tf.error) {
            console.log('error on main');
        } else {
            tf.showTable('div.decode_table');
        }
    }

    $('table.form button').on('click', function () {
        var str = $('textarea.input').val();
        if ($('#invert').is(':checked')) {
            $('textarea.output').val(tf.decodeKeyToVal(str));
        } else {
            $('textarea.output').val(tf.decodeValToKey(str));
        }
    });
});
